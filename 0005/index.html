<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>Doodles | 0005</title>

    <style>
      * { margin:0; padding:0; }
      body {
        font-family: 'Helvetica' 'sans-serif';
        font-size: 24px;
        padding: 40px;
      }
      span { display: block; margin: 40px;}
      h2 { font-weight: normal;}
      .nosupport h2, .nosupport p { display:none; }
    </style>

  </head>

  <body id="js-body" class="nosupport">

    <h2>Orientation:</h2>
    <span id="orientation">This doodle only works on a device that has a gyroscope in it, like an iPhone4 or whatever</span>

    <h2>Background Color:</h2>
    <span id="rgb"></span>

    <p>Move your device around, the orientation dictates the background color of this page</p>

    <script type="text/javascript">

    // linear mapping function factory, maps a domain interval to a range interval linearly (returns floored)
    var mapIntervalsLinearly = function (dmainLowBound, dmainUpBound, rngeLowBound, rngeUpBound) {
      return function (x) { return Math.floor(((x-dmainLowBound)/(dmainUpBound-dmainLowBound))*((rngeUpBound-rngeLowBound)+rngeLowBound)); }
    }

    // create mappings per function
    var mapAlphaToRGB = mapIntervalsLinearly(0,360,0,255),
        mapBetaToRGB  = mapIntervalsLinearly(-90,90,0,255),
        mapGammaToRGB = mapIntervalsLinearly(-180,180,0,255);

    // keep refs to els
    var body          = document.getElementById('js-body'),
        orientationEl = document.getElementById('orientation'),
        rgbEl         = document.getElementById('rgb');

    // on device orientation
    window.ondeviceorientation = function(event) {
      if (event.alpha) {
        body.className = '';
      } else {
        return;
      }

      var orientation = [event.alpha, event.beta, event.gamma],
          rgbFromOrientation = [ mapAlphaToRGB(event.alpha), mapBetaToRGB(event.beta), mapGammaToRGB(event.gamma) ];

      // set body background color according to the color generated by the orientation
      body.style.backgroundColor = ['rgb(',rgbFromOrientation.join(','),')'].join('');

      // display orientation and mapped rgb values
      orientationEl.innerHTML = orientation.join('</br>');
      rgbEl.innerHTML         = rgbFromOrientation.join(',');

    };

    </script>
  </body>
</html>
